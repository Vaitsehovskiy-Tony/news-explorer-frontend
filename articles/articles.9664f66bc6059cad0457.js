!function(e){var t={};function r(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=9)}([function(e,t,r){"use strict";t.a={searchSelector:document.querySelector(".search-form"),cardTemplateMain:"#cardTemplateMain",cardTemplateSaved:"#cardTemplateSaved",popupFormSignin:document.querySelector(".popup__signin"),popupFormSignup:document.querySelector(".popup__signup"),popupAltButton:".popup__alternative-button",popupFormSignupOk:document.querySelector(".popup__signup-ok"),search:{results:document.querySelector(".results"),resultsSearching:document.querySelector(".results__loading"),resultsNothing:document.querySelector(".no-results")},header:{headerSaved:".header-navbar__saved",headerAuth:".header-navbar__auth",headerName:".header-navbar__name",headerNameButton:".header-navbar__menu-item-name",headrbttnLogin:document.querySelector(".header-navbar__menu-item_auth"),headrbttnMobLogin:document.querySelector(".header-mob__menu-item_auth"),headrBttnMobMenuOpen:document.querySelector(".header-navbar__mob-menu-icon"),headrMobClose:document.querySelector(".header-mob__close-icon"),headerMob:document.querySelector(".header-mob")},validator:{popupForm:".popup__form",popupField:".popup__input",popupError:".popup__error",popupSubmit:".popup__button",popupHide:".popup__error_hide"},newsSection:{cardGrid:document.querySelector(".result__cards"),showMoreButton:document.querySelector(".results__show-more")},newsCard:{cardReminderSignin:"Войдите, чтобы сохранять",cardReminderAdd:"Добавить в избранное",cardReminderRemove:"Убрать из сохранённых"},infoSaved:{infoTitle:document.querySelector(".info__your-bookmarks"),infoTemplate:"#infoTemplate"}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return d})),r.d(t,"b",(function(){return c}));const s=new Date,i=`${s.getFullYear()}\n                 -${s.getMonth()}\n                 -${s.getDate()-30}`,n="6aa47727b1b54808b0244a1d2c266dab",o="everything",a="",h="",d={baseUrl:"https://api.newsexplorer.nomoredomains.club/",credentialsState:"include",logoutLink:"logout/",signInLink:"signin/",signUpLink:"signup/",articlesLink:"articles/",usersLink:"users/",usersMeLink:"me/",headers:{"Content-Type":"application/json"}},c={baseUrl:"https://nomoreparties.co/news/v2/top-headlines?"+(a?`country=${a}&`:"")+(i?`from=${i}&`:"")+(o?`sortBy=${o}&`:"")+(n?`apiKey=${n}&`:"")+(h?`category=${h}&`:"")}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));class s{constructor(e,t,{cardCreator:r,newsToCheck:s}){this._container=e.cardGrid,this._showMoreButton=e.showMoreButton,this._keyword=t,this._cardCreator=r,this._newsToCheck=s,this._showMoreHandler=this._showMoreLogic.bind(this)}showNews(){this._cleanContainer(),this._checkIfSaved(),this._checkNewsLength(),this._moreButtonListener()}_checkNewsLength(){this._newsToRender.length>3?(this._showMoreButton.classList.remove("results__show-more_hidden"),this._newsSlicer()):(this._showMoreButton.classList.add("results__show-more_hidden"),this._render(this._newsToRender,this._keyword))}addCard(e){this._container.appendChild(e)}removeCard(e){this._container.removeChild(e)}_render(e,t){for(let r=0;r<e.length;r++)this._cardCreator(e[r],t)}_newsSlicer(){const e=this._newsToRender.slice(0,3);this._newsToRender.splice(0,3),this._render(e,this._keyword)}_showMoreLogic(e){e.preventDefault(),this._checkNewsLength(),this._newsSlicer(),this._removeMoreButtonListener(),this._moreButtonListener()}_moreButtonListener(){this._showMoreButton.addEventListener("click",this._showMoreHandler)}_removeMoreButtonListener(){this._showMoreButton.removeEventListener("click",this._showMoreHandler)}_cleanContainer(){this._container.innerHTML=""}getInfo(){const e=[];this._newsToRender.forEach(t=>e.push(t.firstElementChild.getAttribute(keyword))),console.log(e)}_checkIfSaved(){const e=this._newsToCheck.searchResults.articles,t=this._newsToCheck.savedCards.data;t.length>0&&e.forEach(e=>{e.isLiked=t.some(t=>t.link==e.url)}),this._newsToRender=e}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));class s{constructor(e){this.isLoggedIn=!1,this.baseUrl=e.baseUrl,this.headers=e.headers,this.credentialsState=e.credentialsState,this.logoutLink=e.logoutLink,this.signInLink=e.signInLink,this.signUpLink=e.signUpLink,this.articlesLink=e.articlesLink,this.usersLink=e.usersLink,this.usersMeLink=e.usersMeLink,this.headersAuth=Object.assign({},this.headers,{authorization:"Bearer "+localStorage.getItem("token")})}async _request(e,t,r,s){try{const i=await fetch(this.baseUrl+e,{method:t,headers:r,credentials:this.credentialsState,body:s?JSON.stringify(s):void 0});if(i.ok)return i.json()}catch(e){}}signUp(e,t,r){return this._request(this.signUpLink,"POST",this.headers,{email:e,password:t,name:r})}signIn(e,t){return this._request(this.signInLink,"POST",this.headers,{email:e,password:t})}logout(){return this._request(this.logoutLink,"POST",this.headers)}getArticles(){return this._request(this.articlesLink,"GET",this.headers)}postArticle({keyword:e,title:t,text:r,date:s,source:i,link:n,image:o}){return this._request(this.articlesLink,"POST",this.headers,{keyword:e,title:t,text:r,date:s,source:i,link:n,image:o})}deleteArticle(e){return this._request(this.articlesLink+e,"DELETE",this.headers)}getUserInfo(){return this._request(this.usersLink+this.usersMeLink,"GET",this.headersAuth)}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));class s{constructor(e,{callback:t,popupCallback:r,getInfo:s}){this._headerSaved=document.querySelectorAll(e.headerSaved),this._headerAuth=document.querySelectorAll(e.headerAuth),this._headerName=document.querySelectorAll(e.headerName),this._headerNameButton=document.querySelectorAll(e.headerNameButton),this._callback=t,this._popupCallback=r,this._getInfo=s,this._logoutHandler=this._logoutLogic.bind(this),this._headrbttnLogin=e.headrbttnLogin,this._headrbttnMobLogin=e.headrbttnMobLogin,this._headrBttnMobMenuOpen=e.headrBttnMobMenuOpen,this._headrMobClose=e.headrMobClose,this._headerMob=e.headerMob,this._mobMenuHandler=this._mobMenuLogic.bind(this),this._popupOpenHandler=this._popupOpenLogic.bind(this)}_headerIteratorAdd(e){e.forEach(e=>e.classList.add("header-navbar__menu-item_hidden"))}_headerIteratorRemove(e){e.forEach(e=>e.classList.remove("header-navbar__menu-item_hidden"))}render(e,t){e?(this._headerIteratorAdd(this._headerAuth),this._headerIteratorRemove(this._headerSaved),this._headerIteratorRemove(this._headerName),this._headerNameButton.forEach(e=>e.textContent=t),this._logoutListener()):(this._headerIteratorRemove(this._headerAuth),this._headerIteratorAdd(this._headerSaved),this._headerIteratorAdd(this._headerName),this._headerNameButton.forEach(e=>e.textContent=""),this._removeLogoutListener())}_setEventListeners(){this._popupOpenListener(),this._mobMenuListener()}tokenCheck(e){this._setEventListeners(),e&&this._getInfo(e)}_removePopupOpenListener(){this._headrbttnLogin.removeEventListener("click",this._popupOpenHandler),this._headrbttnMobLogin.removeEventListener("click",this._popupOpenHandler)}_popupOpenListener(){this._headrbttnLogin.addEventListener("click",this._popupOpenHandler),this._headrbttnMobLogin.addEventListener("click",this._popupOpenHandler)}_logoutListener(){this._headerName.forEach(e=>e.addEventListener("click",this._logoutHandler))}_removeLogoutListener(){this._headerName.forEach(e=>e.removeEventListener("click",this._logoutHandler))}_logoutLogic(){this._callback(),this.render(!1,"")}_popupOpenLogic(){this._popupCallback()}_removeMobMenuListener(){this._headrBttnMobMenuOpen.removeEventListener("click",this._mobMenuHandler),this._headrMobClose.removeEventListener("click",this._mobMenuHandler)}_mobMenuListener(){this._headrBttnMobMenuOpen.addEventListener("click",this._mobMenuHandler),this._headrMobClose.addEventListener("click",this._mobMenuHandler)}_mobMenuLogic(){this._headerMob.classList.toggle("header-mob_is-opened")}}},function(e,t,r){"use strict";r.d(t,"a",(function(){return s}));class s{constructor(e,t,{getNews:r}){this._searchSelector=e,this._results=t.results,this._resultsNothing=t.resultsNothing,this._resultsSearching=t.resultsSearching,this._getNews=r,this._searchHandler=this._searchLogic.bind(this)}setSearchListener(){this._searchSelector.addEventListener("submit",this._searchHandler)}_newsSearching(){this._close(this._results),this._open(this._resultsSearching),this._close(this._resultsNothing)}newsFound(){this._open(this._results),this._close(this._resultsSearching),this._close(this._resultsNothing)}newsNoResultsCheck(e){this.newCards=e.articles,0===this.newCards.length||void 0===this.newCards.length?(this._close(this._results),this._close(this._resultsSearching),this._open(this._resultsNothing)):(this._open(this._results),this._results.classList.remove("results_hidden"),this._close(this._resultsSearching),this._close(this._resultsNothing))}startSearch(e){e.addEventListener("submit",e=>{e.preventDefault(),this._newsSearching()})}_searchLogic(e){e.preventDefault(),this._newsSearching(),this._getNews(this._searchSelector.keyword.value)}_open(e){e.classList.remove("results__loading_hidden")}_close(e){e.classList.add("results__loading_hidden")}}},,function(e,t,r){},,function(e,t,r){"use strict";r.r(t);r(7);class s{constructor(e,t,{itemToRemove:r}){this._cardTemplate=e,this._itemToRemove=r,this._cardReminderRemove=t.cardReminderRemove,this._removeHandler=this._removeLogic.bind(this)}_getTemplate(){return document.querySelector(this._cardTemplate).content.cloneNode(!0)}create(e){return this.date=new Date,this.newCard=this._getTemplate(),this._cardId=e._id,this.newCard.querySelector(".card__login-reminder-text").textContent=this._cardReminderRemove,this.newCard.querySelector(".card__date").textContent=this.date.toUTCString(e.date),this.newCard.querySelector(".card__title").textContent=e.title,this.newCard.querySelector(".card__subtitle").textContent=e.text,this.newCard.querySelector(".card__source").textContent=e.source,this.newCard.querySelector(".card__img").setAttribute("src",""+e.image),this.newCard.firstElementChild.setAttribute("src",""+e.link),this.newCard.querySelector(".card__tag").classList.add("active"),this.newCard.querySelector(".card__tag-text").textContent=e.keyword,this._removeListener(),this.newCard.firstElementChild.setAttribute("_id",""+e._id),this.newCard}_removeListener(){this.newCard.firstElementChild.addEventListener("click",this._removeHandler)}_removeLogic(e){e.target.classList.contains("card__bookmark_bin")&&this._itemToRemove(this._cardId,e.target.parentElement)}}var i=r(2),n=r(3),o=r(4),a=r(0);r(5);class h{constructor(e,t,r){this._array=e.data,this._title=t.infoTitle,this._name=r,this._infoTemplate=t.infoTemplate,this._subTitle=document.querySelector(".info__keywords")}giveInfo(){this._getKeywords(),this._makeTitle(),this._getKeywordsData()}_makeSubtitle(e,t){null===e?this._subTitle.textContent="":(this._subTitle.querySelector(".info__keyword-first").textContent=e,t&&(this._subTitle.querySelector(".info__keyword-second").textContent=t))}_makeTitle(){0===this._array.length?this._title.textContent=this._name+", у вас нет сохранённых статей":this._title.textContent=`${this._name}, у вас ${this._array.length} сохранённых статей`}_getKeywordsData(){this._topics=Object.keys(this._keywords),this.number=0;for(let e in this._keywords)this.number++;switch(this._topics.length){case 0:this._makeSubtitle(null);break;case 1:this._makeSubtitle(this._topics[0]);break;case 2:this._makeSubtitle(this._topics[0],this._topics[1]);break;case 3:this._makeSubtitle(`${this._topics[0]}, ${this._topics[1]}`,this._topics[2]);break;default:this._makeSubtitle(`${this._topics[0]}, ${this._topics[1]}`,[this.number-2]+" другим")}}_getKeywords(){this._keywords={};this._array.map(e=>e.keyword).forEach(e=>{this._keywords[e]=(this._keywords[e]||0)+1})}}var d=r(1);const c=new n.a(d.a),l=new o.a(a.a.header,{callback:()=>{c.logout().then(()=>{c.isLoggedIn=!1,localStorage.removeItem("token")}).catch(e=>console.log(e))}},{popupCallback:()=>popupSignin.open()});c.getUserInfo().then(e=>{c.isLoggedIn=!0,l.render(c.isLoggedIn,e.data.name)}).catch(e=>{console.log(e)}),c.getArticles().then(e=>{new h(e,a.a.infoSaved,name="Anton").giveInfo();const t=new i.a(a.a.newsSection,"",{cardCreator:e=>{const r=new s(a.a.cardTemplateSaved,a.a.newsCard,{itemToRemove:(e,r)=>{c.deleteArticle(e).then(e=>{t.removeCard(r),console.log("карточка удалена")}).catch(e=>console.log(e))}});t.addCard(r.create(e))},newsToRender:e.data});t.showNews()}).catch(e=>console.log(e)),l.setEventListeners()}]);