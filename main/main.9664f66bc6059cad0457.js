!function(e){var t={};function s(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,s),r.l=!0,r.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)s.d(i,r,function(t){return e[t]}.bind(null,r));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=8)}([function(e,t,s){"use strict";t.a={searchSelector:document.querySelector(".search-form"),cardTemplateMain:"#cardTemplateMain",cardTemplateSaved:"#cardTemplateSaved",popupFormSignin:document.querySelector(".popup__signin"),popupFormSignup:document.querySelector(".popup__signup"),popupAltButton:".popup__alternative-button",popupFormSignupOk:document.querySelector(".popup__signup-ok"),search:{results:document.querySelector(".results"),resultsSearching:document.querySelector(".results__loading"),resultsNothing:document.querySelector(".no-results")},header:{headerSaved:".header-navbar__saved",headerAuth:".header-navbar__auth",headerName:".header-navbar__name",headerNameButton:".header-navbar__menu-item-name",headrbttnLogin:document.querySelector(".header-navbar__menu-item_auth"),headrbttnMobLogin:document.querySelector(".header-mob__menu-item_auth"),headrBttnMobMenuOpen:document.querySelector(".header-navbar__mob-menu-icon"),headrMobClose:document.querySelector(".header-mob__close-icon"),headerMob:document.querySelector(".header-mob")},validator:{popupForm:".popup__form",popupField:".popup__input",popupError:".popup__error",popupSubmit:".popup__button",popupHide:".popup__error_hide"},newsSection:{cardGrid:document.querySelector(".result__cards"),showMoreButton:document.querySelector(".results__show-more")},newsCard:{cardReminderSignin:"Войдите, чтобы сохранять",cardReminderAdd:"Добавить в избранное",cardReminderRemove:"Убрать из сохранённых"},infoSaved:{infoTitle:document.querySelector(".info__your-bookmarks"),infoTemplate:"#infoTemplate"}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return l})),s.d(t,"b",(function(){return u}));const i=new Date,r=`${i.getFullYear()}\n                 -${i.getMonth()}\n                 -${i.getDate()-30}`,n="6aa47727b1b54808b0244a1d2c266dab",o="everything",a="",h="",l={baseUrl:"https://api.newsexplorer.nomoredomains.club/",credentialsState:"include",logoutLink:"logout/",signInLink:"signin/",signUpLink:"signup/",articlesLink:"articles/",usersLink:"users/",usersMeLink:"me/",headers:{"Content-Type":"application/json"}},u={baseUrl:"https://nomoreparties.co/news/v2/top-headlines?"+(a?`country=${a}&`:"")+(r?`from=${r}&`:"")+(o?`sortBy=${o}&`:"")+(n?`apiKey=${n}&`:"")+(h?`category=${h}&`:"")}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));class i{constructor(e,t,{cardCreator:s,newsToCheck:i}){this._container=e.cardGrid,this._showMoreButton=e.showMoreButton,this._keyword=t,this._cardCreator=s,this._newsToCheck=i,this._showMoreHandler=this._showMoreLogic.bind(this)}showNews(){this._cleanContainer(),this._checkIfSaved(),this._checkNewsLength(),this._moreButtonListener()}_checkNewsLength(){this._newsToRender.length>3?(this._showMoreButton.classList.remove("results__show-more_hidden"),this._newsSlicer()):(this._showMoreButton.classList.add("results__show-more_hidden"),this._render(this._newsToRender,this._keyword))}addCard(e){this._container.appendChild(e)}removeCard(e){this._container.removeChild(e)}_render(e,t){for(let s=0;s<e.length;s++)this._cardCreator(e[s],t)}_newsSlicer(){const e=this._newsToRender.slice(0,3);this._newsToRender.splice(0,3),this._render(e,this._keyword)}_showMoreLogic(e){e.preventDefault(),this._checkNewsLength(),this._newsSlicer(),this._removeMoreButtonListener(),this._moreButtonListener()}_moreButtonListener(){this._showMoreButton.addEventListener("click",this._showMoreHandler)}_removeMoreButtonListener(){this._showMoreButton.removeEventListener("click",this._showMoreHandler)}_cleanContainer(){this._container.innerHTML=""}getInfo(){const e=[];this._newsToRender.forEach(t=>e.push(t.firstElementChild.getAttribute(keyword))),console.log(e)}_checkIfSaved(){const e=this._newsToCheck.searchResults.articles,t=this._newsToCheck.savedCards.data;t.length>0&&e.forEach(e=>{e.isLiked=t.some(t=>t.link==e.url)}),this._newsToRender=e}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));class i{constructor(e){this.isLoggedIn=!1,this.baseUrl=e.baseUrl,this.headers=e.headers,this.credentialsState=e.credentialsState,this.logoutLink=e.logoutLink,this.signInLink=e.signInLink,this.signUpLink=e.signUpLink,this.articlesLink=e.articlesLink,this.usersLink=e.usersLink,this.usersMeLink=e.usersMeLink,this.headersAuth=Object.assign({},this.headers,{authorization:"Bearer "+localStorage.getItem("token")})}async _request(e,t,s,i){try{const r=await fetch(this.baseUrl+e,{method:t,headers:s,credentials:this.credentialsState,body:i?JSON.stringify(i):void 0});if(r.ok)return r.json()}catch(e){}}signUp(e,t,s){return this._request(this.signUpLink,"POST",this.headers,{email:e,password:t,name:s})}signIn(e,t){return this._request(this.signInLink,"POST",this.headers,{email:e,password:t})}logout(){return this._request(this.logoutLink,"POST",this.headers)}getArticles(){return this._request(this.articlesLink,"GET",this.headers)}postArticle({keyword:e,title:t,text:s,date:i,source:r,link:n,image:o}){return this._request(this.articlesLink,"POST",this.headers,{keyword:e,title:t,text:s,date:i,source:r,link:n,image:o})}deleteArticle(e){return this._request(this.articlesLink+e,"DELETE",this.headers)}getUserInfo(){return this._request(this.usersLink+this.usersMeLink,"GET",this.headersAuth)}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));class i{constructor(e,{callback:t,popupCallback:s,getInfo:i}){this._headerSaved=document.querySelectorAll(e.headerSaved),this._headerAuth=document.querySelectorAll(e.headerAuth),this._headerName=document.querySelectorAll(e.headerName),this._headerNameButton=document.querySelectorAll(e.headerNameButton),this._callback=t,this._popupCallback=s,this._getInfo=i,this._logoutHandler=this._logoutLogic.bind(this),this._headrbttnLogin=e.headrbttnLogin,this._headrbttnMobLogin=e.headrbttnMobLogin,this._headrBttnMobMenuOpen=e.headrBttnMobMenuOpen,this._headrMobClose=e.headrMobClose,this._headerMob=e.headerMob,this._mobMenuHandler=this._mobMenuLogic.bind(this),this._popupOpenHandler=this._popupOpenLogic.bind(this)}_headerIteratorAdd(e){e.forEach(e=>e.classList.add("header-navbar__menu-item_hidden"))}_headerIteratorRemove(e){e.forEach(e=>e.classList.remove("header-navbar__menu-item_hidden"))}render(e,t){e?(this._headerIteratorAdd(this._headerAuth),this._headerIteratorRemove(this._headerSaved),this._headerIteratorRemove(this._headerName),this._headerNameButton.forEach(e=>e.textContent=t),this._logoutListener()):(this._headerIteratorRemove(this._headerAuth),this._headerIteratorAdd(this._headerSaved),this._headerIteratorAdd(this._headerName),this._headerNameButton.forEach(e=>e.textContent=""),this._removeLogoutListener())}_setEventListeners(){this._popupOpenListener(),this._mobMenuListener()}tokenCheck(e){this._setEventListeners(),e&&this._getInfo(e)}_removePopupOpenListener(){this._headrbttnLogin.removeEventListener("click",this._popupOpenHandler),this._headrbttnMobLogin.removeEventListener("click",this._popupOpenHandler)}_popupOpenListener(){this._headrbttnLogin.addEventListener("click",this._popupOpenHandler),this._headrbttnMobLogin.addEventListener("click",this._popupOpenHandler)}_logoutListener(){this._headerName.forEach(e=>e.addEventListener("click",this._logoutHandler))}_removeLogoutListener(){this._headerName.forEach(e=>e.removeEventListener("click",this._logoutHandler))}_logoutLogic(){this._callback(),this.render(!1,"")}_popupOpenLogic(){this._popupCallback()}_removeMobMenuListener(){this._headrBttnMobMenuOpen.removeEventListener("click",this._mobMenuHandler),this._headrMobClose.removeEventListener("click",this._mobMenuHandler)}_mobMenuListener(){this._headrBttnMobMenuOpen.addEventListener("click",this._mobMenuHandler),this._headrMobClose.addEventListener("click",this._mobMenuHandler)}_mobMenuLogic(){this._headerMob.classList.toggle("header-mob_is-opened")}}},function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));class i{constructor(e,t,{getNews:s}){this._searchSelector=e,this._results=t.results,this._resultsNothing=t.resultsNothing,this._resultsSearching=t.resultsSearching,this._getNews=s,this._searchHandler=this._searchLogic.bind(this)}setSearchListener(){this._searchSelector.addEventListener("submit",this._searchHandler)}_newsSearching(){this._close(this._results),this._open(this._resultsSearching),this._close(this._resultsNothing)}newsFound(){this._open(this._results),this._close(this._resultsSearching),this._close(this._resultsNothing)}newsNoResultsCheck(e){this.newCards=e.articles,0===this.newCards.length||void 0===this.newCards.length?(this._close(this._results),this._close(this._resultsSearching),this._open(this._resultsNothing)):(this._open(this._results),this._results.classList.remove("results_hidden"),this._close(this._resultsSearching),this._close(this._resultsNothing))}startSearch(e){e.addEventListener("submit",e=>{e.preventDefault(),this._newsSearching()})}_searchLogic(e){e.preventDefault(),this._newsSearching(),this._getNews(this._searchSelector.keyword.value)}_open(e){e.classList.remove("results__loading_hidden")}_close(e){e.classList.add("results__loading_hidden")}}},function(e,t,s){},,function(e,t,s){"use strict";s.r(t);s(6);class i{constructor(e,t,s,{removeNews:i,addNews:r}){this._cardTemplate=e,this._isLoggedIn=t,this._cardReminderSignin=s.cardReminderSignin,this._cardReminderAdd=s.cardReminderAdd,this._removeNews=i,this._addNews=r,this._likeHandler=this._likeLogic.bind(this)}_getTemplate(){return document.querySelector(this._cardTemplate).content.cloneNode(!0)}_chooseReminder(){return this._isLoggedIn?this._cardReminderAdd:this._cardReminderSignin}create(e,t){return this._cardItem=e,this._keyword=t,this.date=new Date,this.newCard=this._getTemplate(),this.newCard.querySelector(".card__login-reminder-text").textContent=this._chooseReminder(),this.newCard.querySelector(".card__date").textContent=this.date.toUTCString(e.publishedAt),this.newCard.querySelector(".card__title").textContent=e.title,this.newCard.querySelector(".card__subtitle").textContent=e.description,this.newCard.querySelector(".card__source").textContent=e.source.name,this.newCard.querySelector(".card__img").setAttribute("src",""+e.urlToImage),this.newCard.firstElementChild.setAttribute("src",""+e.url),t&&this.newCard.firstElementChild.setAttribute("keyword",""+t),this._wasSaved(),this._likeListener(),this.newCard}_wasSaved(){this._cardItem.isLiked&&this.newCard.querySelector(".card__bookmark").classList.add("card__bookmark_logged")}_likeListener(){this.newCard.firstElementChild.addEventListener("click",this._likeHandler)}_likeLogic(e){e.target.classList.contains("card__bookmark_logged")&&1==this._isLoggedIn?(e.target.classList.remove("card__bookmark_logged"),this._removeNews(this.newCard._id)):e.target.classList.contains("card__bookmark")&&1==this._isLoggedIn&&(e.target.classList.add("card__bookmark_logged"),this._addNews(this._cardRepack()))}_cardRepack(){return this.cardToSave={keyword:this._keyword,title:this._cardItem.title,text:this._cardItem.description,date:this._cardItem.publishedAt,source:this._cardItem.source.name,link:this._cardItem.url,image:this._cardItem.urlToImage}}}var r=s(2),n=s(3);class o{constructor(e,t){this._popupSelector=e,this._formElement=this._popupSelector.querySelector(t.popupForm),this._inputElement=t.popupField,this._errorElement=t.popupError,this._errorDisabled=t.popupHide,this._inputs=Array.from(this._formElement.querySelectorAll(this._inputElement)),this._submitButton=this._formElement.querySelector(t.popupSubmit)}enableValidation(){this._formElement.addEventListener("submit",e=>{e.preventDefault()}),this._setInputListeners()}_setInputListeners(){this._inputs.forEach(e=>{e.addEventListener("input",()=>{this._isValid(e),this._submitButtonToggler(this._formElement)})})}_submitButtonToggler(){!this._hasInvalidInput(this._formElement)&&!this._isEmpty()?this._submitButton.classList.add("active"):this._submitButton.classList.remove("active")}_openInputError(e){const t=this._popupSelector.querySelector(`.${e.id}-error`);t.textContent=this._checkInputValidity(e,t),t.classList.remove(this._errorDisabled)}_checkInputValidity(e,t){return e.validity.valueMissing?t.textContent="Это обязательное поле, господин":e.validity.tooShort||e.validity.tooLong?t.textContent="Господин, должно быть от 8 до 30 символов":e.validity.typeMismatch?t.textContent="Здесь должен быть email, господин":void 0}_hideInputError(e){const t=this._popupSelector.querySelector(`.${e.id}-error`);t.textContent="",t.classList.add(this._errorDisabled)}_hasInvalidInput(){return this._inputs.some(e=>!e.validity.valid)}_isEmpty(){return this._inputs.some(e=>""==e.value)}_isValid(e){e.validity.valid?this._hideInputError(e):this._openInputError(e)}}class a{constructor(e){this._popup=e,this._closeButton=this._popup.querySelector(".popup__close"),this._escCloseHandler=this._escCloseLogic.bind(this),this._overlayCloseHandler=this._overlayCloseLogic.bind(this),this._сloseHandler=this.close.bind(this)}open(){this._popup.classList.add("popup_is-opened"),this._setEventListeners()}close(){this._removeEventListeners(),this._popup.classList.remove("popup_is-opened")}_formToggleClass(){this._popup.classList.toggle("popup_is-opened")}_listenerCloseButton(){this._closeButton.addEventListener("click",this._сloseHandler)}_listenerEscClose(){document.addEventListener("keydown",this._escCloseHandler)}_overlayFormListener(){this._popup.addEventListener("click",this._overlayCloseHandler)}_removeListenerCloseButton(){this._closeButton.removeEventListener("click",this._сloseHandler)}_removeListenerEscClose(){document.removeEventListener("keydown",this._escCloseHandler)}_removeOverlayFormListener(){this._popup.removeEventListener("click",this._overlayCloseHandler)}_escCloseLogic(e){"Escape"===e.key&&this.close()}_overlayCloseLogic(e){e.target.classList.contains("overlay")&&this.close()}_setEventListeners(){this._listenerCloseButton(),this._listenerEscClose(),this._overlayFormListener()}_removeEventListeners(){this._removeListenerCloseButton(),this._removeListenerEscClose(),this._removeOverlayFormListener()}}class h extends a{constructor(e){super(e)}open(){super.open()}close(){super.close()}}var l=s(4),u=s(5),c=s(0),d=s(1);const _=new class{constructor(e){this.baseUrl=e.baseUrl}async getInitialCards(e){try{const t=await fetch(`${this.baseUrl}q=${e}`,{method:"GET"});if(t.ok)return t.json()}catch(e){}}}(d.b),p=new n.a(d.a),m=new o(c.a.popupFormSignup,c.a.validator),g=new o(c.a.popupFormSignin,c.a.validator),L=new u.a(c.a.searchSelector,c.a.search,{getNews:e=>{Promise.all([p.getArticles(),_.getInitialCards(e)]).then(([t,s])=>{L.newsNoResultsCheck(s);const n=new r.a(c.a.newsSection,e,{cardCreator:(e,t)=>{const s=new i(c.a.cardTemplateMain,p.isLoggedIn,c.a.newsCard,{addNews:e=>{p.postArticle(e).then(e=>{console.log("карточка сохранена")}).catch(e=>console.log(e.message))},removeNews:e=>{p.deleteArticle(e).then(e=>{console.log("карточка удалена")}).catch(e=>console.log(e.message))}});n.addCard(s.create(e,t))},newsToCheck:{savedCards:t,searchResults:s}});n.showNews()}).catch(e=>console.log(e.message))}}),v=new l.a(c.a.header,{callback:()=>{p.logout().then(()=>{p.isLoggedIn=!1,localStorage.removeItem("token"),document.location.reload()}).catch(e=>console.log(e))},popupCallback:()=>k.open(),getInfo:()=>{p.getUserInfo().then(e=>{v.render(p.isLoggedIn=!0,e.data.name)}).catch(e=>{console.log(e)})}}),b=new class extends a{constructor(e,t,{callback:s,altPopup:i}){super(t),this._callback=s,this._altPopup=i,this.ppp=document.querySelector(".popup__signup"),this._inputs=this._popup.querySelectorAll(".popup__input"),this._popupAltButton=this.ppp.querySelector(e),this._submitHandler=this._submitLogic.bind(this),this._altPopupHandler=this._altPopupLogic.bind(this),this._submitButton=this._popup.querySelector(".popup__button")}open(){super.open(),this._setEventListeners()}close(){super.close(),this._clearInputValues(),this._removeEventListeners()}_getInputValues(){return this._newInputs=[],this._inputs.forEach(e=>this._newInputs.push(e.value)),this._newInputs}_clearInputValues(){this._inputs.forEach(e=>""===e.value)}setInputValues(e){this._inputs[0].value=e.userName,this._inputs[1].value=e.userJob}_setEventListeners(){super._setEventListeners(),this._altPopupListener(),this._submitListener()}_removeEventListeners(){this._removeSubmitListener(),this._removeAltPopupListener()}_submitListener(){this._submitButton.addEventListener("click",this._submitHandler)}_altPopupListener(){this._popupAltButton.addEventListener("click",this._altPopupHandler)}_removeAltPopupListener(){this._popupAltButton.removeEventListener("click",this._altPopupHandler)}_removeSubmitListener(){this._submitButton.removeEventListener("click",this._submitHandler)}_submitLogic(e){e.preventDefault(),this._submitButton.classList.contains("active")&&(this._callback(this._getInputValues()),this.close())}_altPopupLogic(e){e.preventDefault(),this.close(),this._altPopup(e)}}(c.a.popupAltButton,c.a.popupFormSignup,{callback:e=>{p.signUp(e[0],e[1],e[2]).then(e=>{localStorage.setItem("token",e.token),p.isLoggedIn=!0,console.log(e.token)}).then(()=>{p.getUserInfo().then(e=>{v.render(p.isLoggedIn,e.data.name);new h(c.a.popupFormSignupOk).open()}).catch(e=>{console.log(e)})}).catch(e=>console.log(e)),p.signIn(e[0],e[1])},altPopup:e=>{k.open(e)}}),k=new class extends a{constructor(e,t,{callback:s,altPopup:i}){super(t),this._callback=s,this._altPopup=i,this._inputs=this._popup.querySelectorAll(".popup__input"),this.ppp=document.querySelector(".popup__signin"),this._popupAltButton=this.ppp.querySelector(e),this._submitHandler=this._submitLogic.bind(this),this._altPopupHandler=this._altPopupLogic.bind(this),this._getInputValuesContext=this._getInputValues(),this._submitButton=this._popup.querySelector(".popup__button")}open(){super.open(),this._setEventListeners()}close(){super.close(),this._clearInputValues(),this._removeEventListeners()}setInputValues(e){this._inputs[0].value=e.userName,this._inputs[1].value=e.userJob}_getInputValues(){return this._newInputs=[],this._inputs.forEach(e=>this._newInputs.push(e.value)),this._newInputs}_clearInputValues(){this._inputs.forEach(e=>""===e.value)}_setEventListeners(){super._setEventListeners(),this._submitListener(),this._altPopupListener()}_removeEventListeners(){this._removeSubmitListener(),this._removeAltPopupListener()}_submitListener(){this._submitButton.addEventListener("click",this._submitHandler)}_altPopupListener(){this._popupAltButton.addEventListener("click",this._altPopupHandler)}_removeAltPopupListener(){this._popupAltButton.removeEventListener("click",this._altPopupHandler)}_removeSubmitListener(){this._submitButton.removeEventListener("click",this._submitHandler)}_submitLogic(e){e.preventDefault(),this._submitButton.classList.contains("active")&&(this._callback(this._getInputValues()),this.close())}_altPopupLogic(e){e.preventDefault(),this.close(),this._altPopup(e)}}(c.a.popupAltButton,c.a.popupFormSignin,{callback:e=>{p.signIn(e[0],e[1]).then(e=>{localStorage.setItem("token",e.token),p.isLoggedIn=!0}).then(()=>{p.getUserInfo().then(e=>{v.render(p.isLoggedIn,e.data.name)}).catch(e=>{console.log(e)})}).catch(e=>console.log(e))},altPopup:e=>{b.open(e)}});L.setSearchListener(),v.tokenCheck(localStorage.getItem("token")),g.enableValidation(),m.enableValidation()}]);